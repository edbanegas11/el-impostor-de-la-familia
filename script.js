const database = {
   biblia: [
        {w: "Jard√≠n del Ed√©n", h: "Fruta"},
        {w: "Torre de Babel", h: "Idiomas"},
        {w: "Monte Sina√≠", h: "Piedra"},
        {w: "Jerusal√©n", h: "Muro"},
        {w: "R√≠o Jord√°n", h: "Agua"},
        {w: "Mar Rojo", h: "Camino"},
        {w: "Bel√©n", h: "Estrella"},
        {w: "Nazaret", h: "Pueblo"},
        {w: "N√≠nive", h: "Perd√≥n"},
        {w: "Jeric√≥", h: "Grito"},
        {w: "Ad√°n", h: "Tierra"},
        {w: "Goliat", h: "Gigante"},
        {w: "Sans√≥n", h: "Pelo"},
        {w: "Jon√°s", h: "Pez"},
        {w: "Mar√≠a", h: "Madre"},
        {w: "Pedro", h: "Gallo"},
        {w: "Pablo", h: "Cartas"},
        {w: "Abraham", h: "Padre"},
        {w: "Esther", h: "Reina"},
        {w: "Judas Iscariote", h: "Monedas"},
        {w: "El Sembrador", h: "Semilla"},
        {w: "El Buen Samaritano", h: "Viajero"},
        {w: "El Hijo Pr√≥digo", h: "Fiesta"},
        {w: "La Oveja Perdida", h: "Cien"},
        {w: "Los Talentos", h: "Dinero"},
        {w: "El Trigo y la Ciza√±a", h: "Campo"},
        {w: "La Perla de Gran Precio", h: "Tesoro"},
        {w: "Las Diez V√≠rgenes", h: "Aceite"},
        {w: "La Casa sobre la Roca", h: "Lluvia"},
        {w: "La Levadura", h: "Pan"},
        {w: "Arca de la Alianza", h: "Cofre"},
        {w: "Honda de David", h: "Punter√≠a"},
        {w: "Manto de Jes√∫s", h: "Ropa"},
        {w: "Zarza Ardiente", h: "Fuego"},
        {w: "Tablas de la Ley", h: "Lista"},
        {w: "Corona de Espinas", h: "Castigo"},
        {w: "Copa de la √öltima Cena", h: "Vino"},
        {w: "Vara de Aar√≥n", h: "Rama"},
        {w: "Escudo de la Fe", h: "Defensa"},
        {w: "Pan y Peces", h: "Cenas"},
        {w: "El Diluvio", h: "Barco"},
        {w: "La Pascua", h: "Cena"},
        {w: "El Bautismo de Jes√∫s", h: "Paloma"},
        {w: "La Transfiguraci√≥n", h: "Brillo"},
        {w: "La Resurrecci√≥n", h: "Vida"},
        {w: "Pentecost√©s", h: "Viento"},
        {w: "Las Plagas de Egipto", h: "Miedo"},
        {w: "La Crucifixi√≥n", h: "Cruz"},
        {w: "La Creaci√≥n", h: "Mundo"},
        {w: "Las Bodas de Can√°", h: "Boda"}
    ],
comida: [
        {w: "Pizza", h: "Tri√°ngulo"},
        {w: "Hamburguesa", h: "Torre"},
        {w: "Sushi", h: "Palillos"},
        {w: "Taco", h: "Picante"},
        {w: "Espagueti", h: "Enredado"},
        {w: "Helado", h: "Fr√≠o"},
        {w: "Chocolate", h: "Dulce"},
        {w: "Palomitas", h: "Cine"},
        {w: "Huevo", h: "C√°scara"},
        {w: "Pollo frito", h: "Balde"},
        {w: "Papas fritas", h: "Sal"},
        {w: "Ensalada", h: "Verde"},
        {w: "Sopa", h: "Cuchara"},
        {w: "Arroz", h: "Blanco"},
        {w: "Pan", h: "Trigo"},
        {w: "Queso", h: "Rat√≥n"},
        {w: "Sandwich", h: "Capas"},
        {w: "Donas", h: "Agujero"},
        {w: "Lasa√±a", h: "L√°minas"},
        {w: "Pescado", h: "Escamas"},
        {w: "Bistec", h: "Vaca"},
        {w: "Hot Dog", h: "Perro"},
        {w: "Galletas", h: "Leche"},
        {w: "Pastel", h: "Vela"},
        {w: "Caf√©", h: "Taza"},
        {w: "Cereal", h: "Desayuno"},
        {w: "Manzana", h: "Gusano"},
        {w: "Pl√°tano", h: "Mono"},
        {w: "Uvas", h: "Racimo"},
        {w: "Tocino", h: "Cerdo"},
        {w: "Burrito", h: "Rollo"},
        {w: "Paella", h: "Sart√©n"},
        {w: "Nuggets", h: "Caja"},
        {w: "Pancakes", h: "Miel"},
        {w: "Waffles", Cuadros: ""},
        {w: "Churros", h: "Az√∫car"},
        {w: "Gelatina", h: "Movimiento"},
        {w: "Yogur", h: "Bacteria"},
        {w: "Pur√©", h: "Aplastar"},
        {w: "Nachos", h: "Tri√°ngulos"},
        {w: "Alitas", h: "Hueso"},
        {w: "Brocheta", h: "Palito"},
        {w: "Empanada", h: "Relleno"},
        {w: "Ravioles", h: "Pasta"},
        {w: "Pavo", h: "Navidad"},
        {w: "Sand√≠a", h: "Pepitas"},
        {w: "Chicle", h: "Bomba"},
        {w: "Paleta", h: "Lengua"},
        {w: "Mantequilla", h: "Untar"},
        {w: "Cebolla", h: "L√°grima"}
    ],
  profesiones: [
        {w: "Bombero", h: "Agua"},
        {w: "M√©dico", h: "Salud"},
        {w: "Polic√≠a", h: "Orden"},
        {w: "Profesor", h: "Tablero"},
        {w: "Cocinero", h: "Sart√©n"},
        {w: "Astronauta", h: "Estrellas"},
        {w: "Peluquero", h: "Tijeras"},
        {w: "Mec√°nico", h: "Tuerca"},
        {w: "Carpintero", h: "Madera"},
        {w: "Pintor", h: "Brocha"},
        {w: "Fot√≥grafo", h: "Lente"},
        {w: "Cantante", h: "Voz"},
        {w: "Cartero", h: "Sobre"},
        {w: "Veterinario", h: "Mascotas"},
        {w: "Dentista", h: "Muela"},
        {w: "Arquitecto", h: "Plano"},
        {w: "Granjero", h: "Tractor"},
        {w: "Cient√≠fico", h: "Tubo"},
        {w: "Piloto", h: "Nube"},
        {w: "Jardinero", h: "Pala"},
        {w: "Abogado", h: "Leyes"},
        {w: "Periodista", h: "Noticia"},
        {w: "Mesero", h: "Bandeja"},
        {w: "Panadero", h: "Harina"},
        {w: "Costurera", h: "Aguja"},
        {w: "Salvavidas", h: "Silbato"},
        {w: "Electricista", h: "Cable"},
        {w: "Plomero", h: "Tubo"},
        {w: "Barrendero", h: "Escoba"},
        {w: "Cajero", h: "Dinero"},
        {w: "Actor", h: "Guion"},
        {w: "Bailarina", h: "Puntas"},
        {w: "Bibliotecario", h: "Silencio"},
        {w: "Zapatero", h: "Suela"},
        {w: "Alba√±il", h: "Ladrillo"},
        {w: "Arque√≥logo", h: "Huesos"},
        {w: "Detective", h: "Lupa"},
        {w: "Escultor", h: "Cincel"},
        {w: "Payaso", h: "Nariz"},
        {w: "Joyero", h: "Anillo"},
        {w: "Pescador", h: "Red"},
        {w: "Escritor", h: "Pluma"},
        {w: "Deportista", h: "Medalla"},
        {w: "Buzo", h: "Ox√≠geno"},
        {w: "Mago", h: "Varita"},
        {w: "Soldado", h: "Casco"},
        {w: "Chofer", h: "Volante"},
        {w: "Sastre", h: "Medida"},
        {w: "Cuerpo de baile", h: "Escenario"},
        {w: "Guardia", h: "Garita"}
    ],
  objetos: [
        {w: "Sombrilla", h: "Lluvia"},
        {w: "Reloj", h: "Tiempo"},
        {w: "Espejo", h: "Reflejo"},
        {w: "Llave", h: "Cerradura"},
        {w: "C√°mara", h: "Foto"},
        {w: "Lentes", h: "Ojos"},
        {w: "Martillo", h: "Clavo"},
        {w: "Cepillo", h: "Dientes"},
        {w: "Almohada", h: "Sue√±o"},
        {w: "Libro", h: "Hojas"},
        {w: "Tijeras", h: "Corte"},
        {w: "L√°mpara", h: "Luz"},
        {w: "Celular", h: "Llamada"},
        {w: "Bicicleta", h: "Pedal"},
        {w: "Maleta", h: "Viaje"},
        {w: "Escoba", h: "Piso"},
        {w: "Plancha", h: "Ropa"},
        {w: "Control", h: "Bot√≥n"},
        {w: "Vaso", h: "Vidrio"},
        {w: "Silla", h: "Patas"},
        {w: "Cuchara", h: "Boca"},
        {w: "Toalla", h: "Secar"},
        {w: "Peine", h: "Cabello"},
        {w: "Botella", h: "Tapa"},
        {w: "Cartera", h: "Billetes"},
        {w: "Cintur√≥n", h: "Cintura"},
        {w: "Jab√≥n", h: "Burbuja"},
        {w: "Zapatos", h: "Pies"},
        {w: "Globo", h: "Aire"},
        {w: "Paraguas", h: "Nube"},
        {w: "L√°piz", h: "Goma"},
        {w: "Calculadora", h: "N√∫meros"},
        {w: "Bolsa", h: "Pl√°stico"},
        {w: "Ventilador", h: "Viento"},
        {w: "Radio", h: "Sonido"},
        {w: "Candado", h: "Hierro"},
        {w: "Anillo", h: "Dedo"},
        {w: "Encendedor", h: "Chispa"},
        {w: "S√°bana", h: "Cama"},
        {w: "Cuchillo", h: "Filo"},
        {w: "Mochila", h: "Espalda"},
        {w: "Regla", h: "Medida"},
        {w: "Papel", h: "Blanco"},
        {w: "Clavo", h: "Punta"},
        {w: "Moneda", h: "Metal"},
        {w: "Brocha", h: "Pared"},
        {w: "Cuerda", h: "Nudo"},
        {w: "Pila", h: "Energ√≠a"},
        {w: "Basurero", h: "Desecho"},
        {w: "Taza", h: "Asa"}
    ],
  celebridades: [
        {w: "Lionel Messi", h: "Bal√≥n"},
        {w: "Michael Jackson", h: "Guante"},
        {w: "Shakira", h: "Cadera"},
        {w: "Albert Einstein", h: "Lengua"},
        {w: "Cristiano Ronaldo", h: "Salto"},
        {w: "Marilyn Monroe", h: "Vestido"},
        {w: "Walt Disney", h: "Rat√≥n"},
        {w: "Elvis Presley", h: "Tup√©"},
        {w: "Bill Gates", h: "Ventanas"},
        {w: "Beyonc√©", h: "Abeja"},
        {w: "Leonardo da Vinci", h: "Cuadro"},
        {w: "Christopher Colombus", h: "Barcos"},
        {w: "Julio C√©sar", h: "Corona"},
        {w: "Steve Jobs", h: "Manzana"},
        {w: "Madonna", h: "Ambici√≥n"},
        {w: "Usain Bolt", h: "Rayo"},
        {w: "Tiger Woods", h: "Hoyo"},
        {w: "Pel√©", h: "Brasil"},
        {w: "Will Smith", h: "Pr√≠ncipe"},
        {w: "Angelina Jolie", h: "Labios"},
        {w: "Brad Pitt", h: "Rubio"},
        {w: "Lady Gaga", h: "Monstruo"},
        {w: "Justin Bieber", h: "Flequillo"},
        {w: "Arnold Schwarzenegger", h: "M√∫sculo"},
        {w: "Jackie Chan", h: "Patada"},
        {w: "Bruce Lee", h: "Grito"},
        {w: "Nelson Mandela", h: "Celda"},
        {w: "Abraham Lincoln", h: "Sombrero"},
        {w: "Pablo Picasso", h: "Pincel"},
        {w: "Isaac Newton", h: "Gravedad"},
        {w: "Ludwig van Beethoven", h: "Sordo"},
        {w: "Wolfgang Amadeus Mozart", h: "Piano"},
        {w: "Freddie Mercury", h: "Bigote"},
        {w: "John Lennon", h: "Gafas"},
        {w: "Bob Marley", h: "Rastas"},
        {w: "Charles Chaplin", h: "Bast√≥n"},
        {w: "Tom Cruise", h: "Misi√≥n"},
        {w: "Johnny Depp", h: "Pirata"},
        {w: "Britney Spears", h: "Colegio"},
        {w: "Rihanna", h: "Paraguas"},
        {w: "Michael Jordan", h: "Aro"},
        {w: "Elon Musk", h: "Marte"},
        {w: "Stephen Hawking", h: "Silla"},
        {w: "Salvador Dal√≠", h: "Reloj"},
        {w: "Cleopatra", h: "Egipto"},
        {w: "Juana de Arco", h: "Armadura"},
        {w: "Napole√≥n Bonaparte", h: "Mano"},
        {w: "Marco Polo", h: "Viaje"},
        {w: "Ghandi", h: "Paz"},
        {w: "Amelia Earhart", h: "Avi√≥n"}
    ],
  cine: [
        {w: "Titanic", h: "Barco"},
        {w: "El Rey Le√≥n", h: "Sabana"},
        {w: "Avatar", h: "Azul"},
        {w: "Harry Potter", h: "Cicatriz"},
        {w: "Star Wars", h: "Sable"},
        {w: "Batman", h: "Murci√©lago"},
        {w: "Spider-Man", h: "Telara√±a"},
        {w: "Toy Story", h: "Juguetes"},
        {w: "Shrek", h: "Pantano"},
        {w: "Juego de Tronos", h: "Drag√≥n"},
        {w: "La Casa de Papel", h: "M√°scara"},
        {w: "Stranger Things", h: "Bicicleta"},
        {w: "Los Simpson", h: "Amarillo"},
        {w: "Jurassic Park", h: "Dinosaurio"},
        {w: "Jaws", h: "Aleta"},
        {w: "El Padrino", h: "Gato"},
        {w: "Matrix", h: "Pastilla"},
        {w: "Indiana Jones", h: "L√°tigo"},
        {w: "Coco", h: "Guitarra"},
        {w: "Frozen", h: "Hielo"},
        {w: "Buscando a Nemo", h: "Aleta"},
        {w: "Misi√≥n Imposible", h: "Mecha"},
        {w: "El Joker", h: "Risa"},
        {w: "Los Incre√≠bles", h: "Antifaz"},
        {w: "Ratatouille", h: "Chef"},
        {w: "Up", h: "Globos"},
        {w: "La Bella y la Bestia", h: "Rosa"},
        {w: "Cenicienta", h: "Zapato"},
        {w: "El Chavo del 8", h: "Barril"},
        {w: "Squid Game", h: "N√∫mero"},
        {w: "Los Vengadores", h: "Guantelete"},
        {w: "Mi Pobre Angelito", h: "Trampa"},
        {w: "Grease", h: "Brillantina"},
        {w: "El Resplandor", h: "Hacha"},
        {w: "It", h: "Globo"},
        {w: "Rocky", h: "Boxeo"},
        {w: "Rambo", h: "Cinta"},
        {w: "Terminator", h: "Metal"},
        {w: "El Se√±or de los Anillos", h: "Volc√°n"},
        {w: "Piratas del Caribe", h: "Br√∫jula"},
        {w: "Cars", h: "Rayo"},
        {w: "Madagascar", h: "Zool√≥gico"},
        {w: "La Purga", h: "Sirena"},
        {w: "Black Panther", h: "Garra"},
        {w: "Braveheart", h: "Cara"},
        {w: "Gladiador", h: "Arena"},
        {w: "King Kong", h: "Edificio"},
        {w: "Godzilla", h: "Radioactivo"},
        {w: "Barbie", h: "Rosado"},
        {w: "Wednesday", h: "Baile"}
    ],
  marcas: [
        {w: "Nike", h: "Gancho"},
        {w: "Coca-Cola", h: "Rojo"},
        {w: "Apple", h: "Mordisco"},
        {w: "McDonald's", h: "Arcos"},
        {w: "Google", h: "Colores"},
        {w: "Amazon", h: "Flecha"},
        {w: "Netflix", h: "N"},
        {w: "Facebook", h: "Azul"},
        {w: "Instagram", h: "C√°mara"},
        {w: "WhatsApp", h: "Verde"},
        {w: "YouTube", h: "Bot√≥n"},
        {w: "Adidas", h: "Rayas"},
        {w: "Starbucks", h: "Sirena"},
        {w: "Disney", h: "Castillo"},
        {w: "Ferrari", h: "Caballo"},
        {w: "Pepsi", h: "C√≠rculo"},
        {w: "Samsung", h: "Corea"},
        {w: "Toyota", h: "√ìvalos"},
        {w: "Mercedes-Benz", h: "Estrella"},
        {w: "Microsoft", h: "Ventana"},
        {w: "Sony", h: "Jap√≥n"},
        {w: "Nintendo", h: "Consola"},
        {w: "Puma", h: "Felino"},
        {w: "Lego", h: "Bloque"},
        {w: "IKEA", h: "Mueble"},
        {w: "Rolex", h: "Corona"},
        {w: "Louis Vuitton", h: "Bolso"},
        {w: "Chanel", h: "Perfume"},
        {w: "Zara", h: "Moda"},
        {w: "H&M", h: "Ropa"},
        {w: "Burger King", h: "Corona"},
        {w: "KFC", h: "Coronel"},
        {w: "Subway", h: "Metro"},
        {w: "Pizza Hut", h: "Techo"},
        {w: "Ford", h: "Carro"},
        {w: "Audi", h: "Aros"},
        {w: "Tesla", h: "Rayo"},
        {w: "Twitter", h: "P√°jaro"},
        {w: "TikTok", h: "Nota"},
        {w: "Spotify", h: "Ondas"},
        {w: "PayPal", h: "Pago"},
        {w: "Visa", h: "Tarjeta"},
        {w: "Mastercard", h: "C√≠rculos"},
        {w: "Dove", h: "Paloma"},
        {w: "Colgate", h: "Dientes"},
        {w: "Red Bull", h: "Toro"},
        {w: "Monster", h: "Garra"},
        {w: "Gillette", h: "Navaja"},
        {w: "Nestl√©", h: "Nido"},
        {w: "Nutella", h: "Avellana"}
    ],
  lugares: [
        {w: "Francia", h: "Torre"},
        {w: "Egipto", h: "Pir√°mide"},
        {w: "Italia", h: "Bota"},
        {w: "China", h: "Muralla"},
        {w: "Brasil", h: "Estatua"},
        {w: "Estados Unidos", h: "Libertad"},
        {w: "Jap√≥n", h: "Sol"},
        {w: "M√©xico", h: "Sombrero"},
        {w: "Rusia", h: "Fr√≠o"},
        {w: "India", h: "Templo"},
        {w: "Espa√±a", h: "Toro"},
        {w: "Reino Unido", h: "Reloj"},
        {w: "Australia", h: "Canguro"},
        {w: "Canad√°", h: "Hoja"},
        {w: "Argentina", h: "Obelisco"},
        {w: "Colombia", h: "Caf√©"},
        {w: "Par√≠s", h: "Luz"},
        {w: "Nueva York", h: "Manzana"},
        {w: "Roma", h: "Coliseo"},
        {w: "Londres", h: "Niebla"},
        {w: "Grecia", h: "Columnas"},
        {w: "Egipto", h: "Desierto"},
        {w: "Suiza", h: "Alpes"},
        {w: "Holanda", h: "Molino"},
        {w: "Per√∫", h: "Ruinas"},
        {w: "Chile", h: "Cordillera"},
        {w: "Venecia", h: "Canal"},
        {w: "Dub√°i", h: "Lujo"},
        {w: "Turqu√≠a", h: "Mezquita"},
        {w: "Alemania", h: "Muro"},
        {w: "Pek√≠n", h: "Drag√≥n"},
        {w: "Jerusal√©n", h: "Muro"},
        {w: "El Vaticano", h: "Papa"},
        {w: "R√≠o de Janeiro", h: "Carnaval"},
        {w: "Mosc√∫", h: "Plaza"},
        {w: "Tokio", h: "Neon"},
        {w: "√Åmsterdam", h: "Bici"},
        {w: "Atenas", h: "Sabios"},
        {w: "Barcelona", h: "Sagrada"},
        {w: "Pisa", h: "Inclinada"},
        {w: "Ecuador", h: "Mitad"},
        {w: "Panam√°", h: "Canal"},
        {w: "Costa Rica", h: "Pura"},
        {w: "Cuba", h: "Puro"},
        {w: "Venezuela", h: "Salto"},
        {w: "Bolivia", h: "Salar"},
        {w: "Tailandia", h: "Elefante"},
        {w: "Marruecos", h: "Arena"},
        {w: "Portugal", h: "Gallo"},
        {w: "Corea del Sur", h: "Tecnolog√≠a"}
    ],
};

let players = [], selectedCategory = '', secretWord = '', currentHint = '', impostors = [], currentPlayerIndex = 0, isWordRevealed = false, timerInterval = null;
let cfgImpostors = 1, cfgMinutes = 3;

function addPlayer() {
    const input = document.getElementById('playerNameInput');
    if (input.value.trim()) {
        players.push(input.value.trim());
        input.value = "";
        renderPlayers();
    }
}

function renderPlayers() {
    document.getElementById('namesList').innerHTML = players.map((p, i) => `
        <div class="stack-item"><span>${p}</span><button onclick="removePlayer(${i})" style="color:var(--danger); background:none; border:none; font-weight:800;">X</button></div>
    `).join('');
    document.getElementById('toStep2').classList.toggle('hidden', players.length < 3);
    document.getElementById('clearListBtn').classList.toggle('hidden', players.length === 0);
}

function removePlayer(i) { players.splice(i, 1); renderPlayers(); }
function clearAllPlayers() { players = []; renderPlayers(); }

function showStep(stepId) {
    document.querySelectorAll('.step').forEach(s => s.classList.add('hidden'));
    document.getElementById(stepId).classList.remove('hidden');
    document.getElementById('backAction').classList.toggle('hidden', stepId === 'step1');
}

function goToStep2() { showStep('step2'); }
function goToStart() { if (timerInterval) clearInterval(timerInterval); showStep('step1'); }

function goBack() {
    if (!document.getElementById('step2').classList.contains('hidden')) showStep('step1');
    else if (!document.getElementById('stepSettings').classList.contains('hidden')) showStep('step2');
    else if (!document.getElementById('game').classList.contains('hidden')) showStep('stepSettings');
}

function selectCategory(cat) {
    selectedCategory = cat;
    cfgImpostors = 1; // Resetear a 1 impostor por defecto
    document.getElementById('impVal').innerText = cfgImpostors;
    showStep('stepSettings');
}

function changeImpostors(val) {
    // M√°ximo la mitad de los jugadores para que tenga sentido
    const maxImp = Math.max(1, Math.floor(players.length / 2)); 
    cfgImpostors = Math.max(1, Math.min(maxImp, cfgImpostors + val));
    document.getElementById('impVal').innerText = cfgImpostors;
}

function changeTime(val) {
    cfgMinutes = Math.max(1, Math.min(10, cfgMinutes + val));
    document.getElementById('timeVal').innerText = cfgMinutes;
}

function startGame() {
    // L√≥gica para elegir palabra (incluyendo categor√≠a TODAS)
    let pool = [];
    if (selectedCategory === 'todas') {
        pool = Object.values(database).flat();
    } else {
        pool = database[selectedCategory];
    }
    
    if (!pool || pool.length === 0) return alert("Categor√≠a vac√≠a");
    
    const item = pool[Math.floor(Math.random() * pool.length)];
    secretWord = item.w;
    currentHint = item.h;

    // Seleccionar m√∫ltiples impostores aleatorios
    impostors = [];
    let poolIndices = [...Array(players.length).keys()];
    for(let i=0; i<cfgImpostors; i++) {
        let randIdx = Math.floor(Math.random() * poolIndices.length);
        impostors.push(poolIndices.splice(randIdx, 1)[0]);
    }

    currentPlayerIndex = 0;
    showStep('game');
    updateTurnUI();
}

function updateTurnUI() {
    document.getElementById('turnTitle').innerText = players[currentPlayerIndex];
    document.getElementById('wordBox').classList.add('hidden');
    document.getElementById('mainBtn').innerText = "VER PALABRA";
    isWordRevealed = false;
}

function flow() {
    if (!isWordRevealed) {
        const isImp = impostors.includes(currentPlayerIndex);
        document.getElementById('secretWord').innerText = isImp ? "¬°ERES EL IMPOSTOR!" : secretWord;
        document.getElementById('secretWord').style.color = isImp ? "var(--danger)" : "var(--accent)";
        document.getElementById('hintArea').classList.toggle('hidden', !isImp);
        document.getElementById('hintText').innerText = currentHint;
        document.getElementById('wordBox').classList.remove('hidden');
        document.getElementById('mainBtn').innerText = "ENTENDIDO";
        isWordRevealed = true;
    } else {
        currentPlayerIndex++;
        if (currentPlayerIndex < players.length) updateTurnUI();
        else startDebate();
    }
}

function startDebate() {
    showStep('finish');
    const starter = players[Math.floor(Math.random() * players.length)];
    document.getElementById('whoStarts').innerHTML = `üéôÔ∏è INICIA LA RONDA: <br><span style="color:var(--accent); font-size:1.5rem;">${starter}</span>`;
    document.getElementById('impostorResult').classList.add('hidden');
    document.getElementById('endOptions').classList.add('hidden');
    document.getElementById('revealBtn').classList.remove('hidden');
    document.getElementById('timerDisplay').innerText = `${cfgMinutes}:00`;
    startTimer(cfgMinutes * 60);
}

function startTimer(seconds) {
    if (timerInterval) clearInterval(timerInterval);
    let t = seconds;
    timerInterval = setInterval(() => {
        let m = Math.floor(t / 60), s = t % 60;
        document.getElementById('timerDisplay').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        if (--t < 0) clearInterval(timerInterval);
    }, 1000);
}

function revealImpostor() {
    const names = impostors.map(idx => players[idx]).join(", ");
    document.getElementById('impostorName').innerText = names;
    document.getElementById('impostorResult').classList.remove('hidden');
    document.getElementById('endOptions').classList.remove('hidden');
    document.getElementById('revealBtn').classList.add('hidden');
    document.getElementById('whoStarts').innerHTML = "";
    if (timerInterval) clearInterval(timerInterval);
}

function newRound() { showStep('step2'); }
